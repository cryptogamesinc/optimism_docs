---
title: EthereumとOP Stackチェーンの違い
lang: ja-JP
description: EthereumとOP Stackチェーンの動作の違いについて学びましょう。
---

import { Callout } from 'nextra/components'

# EthereumとOP Stackチェーンの違い

OP Stackチェーンは[EVM equivalent](https://web.archive.org/web/20231127160757/https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306)を目指して設計されており、Ethereumプロトコルへの変更を最小限に抑えています。
しかし、EthereumとOP Stackチェーンの動作には開発者が注意すべきいくつかの小さな違いがあります。

## Opcodes

| Opcode       | Solidity Equivalent | 動作                                                                                                                                                               |
| ------------ | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `COINBASE`   | `block.coinbase`    | 現在のSequencerの手数料ウォレットのアドレスを返します。ブロックごとに値が通常変わらない点を除いて、Ethereumと実質的に同じです。                                                                                         |
| `PREVRANDAO` | `block.prevrandao`  | Ethereum上の[RANDAO](https://eips.ethereum.org/EIPS/eip-4399)が提供する強力な保証とは対照的に、Sequencerによって各ブロックごとに**擬似ランダム**に設定されます。                                              |
| `ORIGIN`     | `tx.origin`         | トランザクションがL1 ⇒ L2トランザクションであり、L1上のスマートコントラクトによってトリガーされた場合、`tx.origin`はL1 ⇒ L2トランザクションをトリガーしたアドレスの[エイリアスアドレス](#address-aliasing)に設定されます。それ以外の場合、このopcodeは通常通り動作します。 |
| `CALLER`     | `msg.sender`        | トランザクションがL1 ⇒ L2トランザクションであり、これは最初のコールフレーム（スマートコントラクト間の内部トランザクションではない）場合、同じ[アドレスエイリアシング](#address-aliasing)動作が適用されます。                                             |

### アドレスエイリアシング

<Callout>
  アドレスエイリアシングは、L1からL2にスマートコントラクトによって送信されるトランザクションの動作に影響を与える重要なセキュリティ機能です。
  クロスチェーントランザクションに取り組んでいる場合は、このセクションを注意深く読んでください。
  `CrossChainMessenger`コントラクトは、内部でアドレスエイリアシングを処理します。
</Callout>

Externally Owned AccountからL1からL2にトランザクションが送信される場合、L2でのトランザクションの送信者のアドレスはL1でのトランザクションの送信者のアドレスに設定されます。
**しかし、L2でのトランザクションの送信者のアドレスは、L1上のスマートコントラクトによってトリガーされた場合、異なるものになります**。

`CREATE` opcodeの動作により、同じアドレスを共有するがバイトコードが異なる契約をL1とL2の両方で作成することが可能です。
これらの契約は同じアドレスを共有していますが、基本的に2つの異なるスマートコントラクトであり、同じ契約として扱うことはできません。
その結果、L1からL2にスマートコントラクトによって送信されたトランザクションの送信者は、L1のスマートコントラクトのアドレスではなく、L1のスマートコントラクトがL2のスマートコントラクトとして振る舞うことができるように、L2トランザクションが送信者のアドレスをわずかに変更します。

このような偽装を防ぐために、トランザクションがスマートコントラクトによってL1からL2に送信された場合、送信者のアドレスはわずかに変更されます。
実際のL1コントラクトアドレスから送信されたように見える代わりに、L2トランザクションはL1コントラクトアドレスの「エイリアス」バージョンから送信されたように見えます。
このエイリアスアドレスは、元のL1アドレスが簡単に復元できるように、L1コントラクトアドレスから一定のオフセットを持つ定数です。

この送信者アドレスの変更は、L1スマートコントラクトによって送信されたL2トランザクションにのみ適用されます。
他のすべての場合、トランザクション送信者アドレスはEthereumで使用される同じルールに従って設定されます。

| トランザクションの送信元                                     | 送信者アドレス                                                            |
| ------------------------------------------------ | ------------------------------------------------------------------ |
| L2ユーザー（Externally Owned Account）                 | ユーザーのアドレス（Ethereumと同じ）                                             |
| L1ユーザー（Externally Owned Account）                 | ユーザーのアドレス（Ethereumと同じ）                                             |
| L1コントラクト（`OptimismPortal.depositTransaction`を使用） | `L1_contract_address + 0x1111000000000000000000000000000000001111` |

## トランザクション

### トランザクション手数料

OP Stackチェーンのトランザクションは、標準的な[execution gas fee](/stack/transactions/fees#execution-gas-fee)に加えて[L1 data fee](/stack/transactions/fees#the-l1-data-fee)を支払う必要があります。
詳細については、[OP Stack Transaction Fees](/stack/transactions/fees)ガイドを参照してください。

### EIP-1559パラメータ

OP Stackのベース手数料は、Ethereumと同様に[EIP-1559](https://notes.ethereum.org/@vbuterin/eip-1559-faq)メカニズムを介して計算されます。
OP Stackで使用されるEIP-1559パラメータはチェーンごとに異なります。

### Mempoolのルール

デフォルトでは、OP StackチェーンにはEthereumのような大きな公開mempoolはありません。
OP Stackのmempoolは通常、特定のチェーンのSequencerのみに見えるようになっており、トランザクションは一般的に優先手数料順（最も高い手数料が最初）に実行されます。
これは必須の動作ではなく、特定のチェーンが公開mempoolを持つことを選択することもあります。
