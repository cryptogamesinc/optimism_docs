---
title: EthereumとOPメインネットの違い
lang: ja-JP
description: OPメインネットとEthereumの動作の細かな違いについて学びます。
---

import { Callout } from 'nextra/components'

# EthereumとOPメインネットの違い

OPメインネットは[EVM equivalent](https://web.archive.org/web/20231127160757/https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306)として設計されており、Ethereumプロトコルにできるだけ少ない変更を加えることを目指しています。
しかし、開発者が認識すべきEthereumとOPメインネットの間のいくつかの小さな違いがあります。

## オペコード

| オペコード     | Solidity相当の記述        | 挙動                                                                                                                                            |
| -------------- | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| `COINBASE`     | `block.coinbase`          | 現在のSequencerの手数料ウォレットのアドレスを返します。Ethereumとほぼ同じですが、ブロックごとに値が変わることはほとんどありません。              |
| `PREVRANDAO`   | `block.prevrandao`        | Sequencerによりブロックごとに**擬似乱数**で設定され、Ethereumの[RANDAO](https://eips.ethereum.org/EIPS/eip-4399)による強い保証とは異なります。 |
| `ORIGIN`       | `tx.origin`               | トランザクションがL1からL2へのトリガーとなるスマートコントラクトによって開始された場合、`tx.origin`はそのL1からL2へのトリガーを引き起こしたアドレスの[エイリアスアドレス](#address-aliasing)に設定されます。それ以外の場合は、このオペコードは通常通りに動作します。 |
| `CALLER`       | `msg.sender`              | トランザクションがL1からL2へのトリガーとなるスマートコントラクトによって開始され、これが最初のコールフレーム（他のコントラクト間の内部トランザクションではない）の場合、同じ[アドレスエイリアシング](#address-aliasing)の挙動が適用されます。 |

### アドレスエイリアシング

<Callout>
  アドレスエイリアシングは、スマートコントラクトによってL1からL2に送信されるトランザクションの挙動に影響を与える重要なセキュリティ機能です。
  クロスチェーントランザクションを扱う場合、このセクションを注意深く読むことが重要です。
  なお、`CrossChainMessenger`コントラクトは、アドレスエイリアシングを内部で処理します。
</Callout>

L1からL2に外部所有アカウントによって送信されるトランザクションの場合、L2でのトランザクションの送信者のアドレスはL1でのトランザクションの送信者のアドレスに設定されます。
**ただし、トランザクションがL1のスマートコントラクトによってトリガーされた場合、L2でのトランザクションの送信者のアドレスは異なります。**

`CREATE`オペコードの挙動により、L1とL2の両方で同じアドレスを共有するが異なるバイトコードを持つコントラクトを作成することが可能です。
これらのコントラクトは同じアドレスを共有していますが、根本的に異なるスマートコントラクトであり、同一のコントラクトとして扱うことはできません。
その結果、L1のスマートコントラクトによってL2に送信されるトランザクションの送信者は、L1のスマートコントラクトのアドレスではなくなります。

このような偽装を防ぐため、L1のスマートコントラクトによってL2に送信されるトランザクションの送信者は若干変更されます。
実際のL1のコントラクトアドレスから送信されたように見えるのではなく、L1のコントラクトアドレスの「エイリアス」バージョンから送信されたように見えます。
このエイリアスアドレスは実際のL1コントラクトアドレスから一定のオフセットを持つもので、L2上で他のアドレスと衝突することはなく、エイリアスアドレスから元のL1アドレスを容易に復元することができます。

この送信者アドレスの変更は、L1のスマートコントラクトによって送られるL2トランザクションにのみ適用されます。
他のすべてのケースでは、トランザクションの送信者アドレスはEthereumと同じルールに従って設定されます。

| トランザクションの出所                                      | 送信者アドレス                                                 |
| ----------------------------------------------------------- | ------------------------------------------------------------ |
| L2ユーザー（外部所有アカウント）                             | ユーザーのアドレス（Ethereumと同じ）                           |
| L1ユーザー（外部所有アカウント）                             | ユーザーのアドレス（Ethereumと同じ）                           |
| L1コントラクト（`OptimismPortal.depositTransaction`を使用） | `L1_contract_address + 0x1111000000000000000000000000000000001111` |

## トランザクション

### トランザクション手数料

OPメインネットのトランザクションは、Ethereumで期待される標準の[実行ガス手数料](/stack/transactions/fees#execution-gas-fee)に加えて、[L1データ料金](/stack/transactions/fees#the-l1-data-fee)を支払う必要があります。
詳細については、[OPメインネットトランザクション手数料](/stack/transactions/fees)ガイドを参照してください。

### EIP-1559パラメータ

OPメインネットの基本料金は、Ethereumと同様に、[EIP-1559](https://notes.ethereum.org/@vbuterin/eip-1559-faq)メカニズムを通じて計算されます。
OPメインネットで使用されるEIP-1559のパラメータは、Ethereumで使用されるものと以下のように異なります。

| パラメータ                             | OPメインネットの値 | Ethereumの値（参考） |
| ------------------------------------- | ----------------: | --------------------: |
| ブロックガスリミット                   |   30,000,000ガス  |          30,000,000ガス |
| ブロックガスターゲット                 |    5,000,000ガス  |          15,000,000ガス |
| EIP-1559弾力性乗数                     |                6  |                     2 |
| EIP-1559分母                           |              250  |                     8 |
| 最大基本料金増加（ブロックごと）       |              10%  |                 12.5% |
| 最大基本料金減少（ブロックごと）       |               2%  |                 12.5% |
| ブロック時間（秒）                     |                2  |                    12 |

### Mempoolのルール

Ethereumとは異なり、OPメインネットには大きな公開メンプールがありません。
OPメインネットのシーケンサーメンプールは現在、シーケンサーにのみ表示されます。
シーケンサーはメンプールのトランザクションを優先料金順（最も高い料金から）で実行します。