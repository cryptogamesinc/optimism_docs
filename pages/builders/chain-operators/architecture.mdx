---
title: チェーンアーキテクチャ
lang: ja-JP
description: OPチェーンアーキテクチャについて学びましょう。
---

import Image from 'next/image'

# チェーンアーキテクチャ

このページでは、ロールアッププロトコルのコンポーネントと、それらがどのように連携してLayer 2ブロックチェーンを構築するかについて、チェーンオペレーターの視点から説明します。OPスタックはEthereumに可能な限り似せて構築されています。Ethereumと同様に、OPスタックには実行クライアントとコンセンサスクライアントがあります。また、OPスタックにはL2ブロックを生成する特権的な役割もあります。OPスタックプロトコルの詳細な概要については、[OPスタックセクション](/stack/getting-started)をご覧ください。

## パーミッションドコンポーネント

これらのクライアントとサービスは、L2ネットワーク上でのブロック生成を可能にするために連携しています。シーケンサーノード（`op-geth` + `op-node`）は、ユーザーから提案されたトランザクションを収集します。バッチャーはL1にバッチデータを送信し、これが安全なブロックを制御し、最終的に正規のチェーンを制御します。プロポーザーは出力ルートをL1に送信し、これがL2からL1へのメッセージングを制御します。

<Image src="/img/builders/chain-operators/sequencer-diagram.png" alt="シーケンサコンポーネントの図" width={400} height={400} />

### op-geth

`op-geth`は、[最小限の変更](https://op-geth.optimism.io/)で安全なEthereum相当のアプリケーション環境を提供するLayer 2の実行レイヤーを実装します。

### op-node

`op-node`は、Layer 2のコンセンサスレイヤーとして、ほとんどのロールアップ特有の機能を実装します。これはLayer 1のビーコンノードに似ています。`op-node`はステートレスであり、その世界観を`op-geth`から取得します。

### op-batcher

`op-batcher`は、L2シーケンサーデータをL1に送信し、検証者が利用できるようにするサービスです。L1への書き込みコストを削減するために、L2ブロックを再現するために必要な最小限のデータのみを投稿します。

### op-proposer

`op-proposer`は、出力ルートをL1に送信するサービスです。これはL2からL1へのメッセージングの信頼性のある実行を可能にし、L1から見たL2の状態のビューを作成します。

## インバウンドトラフィック

ユーザーからの大量のRPCリクエストを処理するためには、堅牢なチェーンアーキテクチャを設定することが重要です。シーケンサーノードはブロック生成を担当するため、バッチャーと連携してその仕事を行います。シーケンサーがその仕事に集中できるように、レプリカノードをピアリングして他の作業を処理させることができます。

その一例として、[proxyd](https://github.com/ethereum-optimism/optimism/tree/develop/proxyd)を設定してRPCメソッドをルーティングし、失敗したリクエストを再試行し、ロードバランシングなどを行うことができます。`eth_sendRawTransaction`リクエストを送信するユーザーのリクエストはシーケンサーに直接転送されます。他のRPCリクエストはレプリカノードに転送されます。

<Image src="/img/builders/chain-operators/ingress-traffic-diagram.png" alt="インバウンドトラフィックの図" width={400} height={400} />

### proxyd

このツールはRPCリクエストルーターおよびプロキシです。以下の機能があります。

1.  RPCメソッドのホワイトリスト作成。
2.  RPCメソッドをバックエンドサービスのグループにルーティング。
3.  失敗したバックエンドリクエストを自動的に再試行。
4.  バックエンドのコンセンサス（最新、安全、確定ブロック）、ピア数、同期状態を追跡。
5.  コンセンサスを強制するためにリクエストとレスポンスを再書き込み。
6.  バックエンドサービス間でリクエストをロードバランシング。
7.  バックエンドからの不変のレスポンスをキャッシュ。
8.  リクエストのレイテンシ、エラーレートなどを測定するメトリクスを提供。

### シーケンサー

シーケンサーノードは、バッチャーおよびプロポーザーと連携して新しいブロックを作成します。したがって、状態変更RPCリクエストである`eth_sendRawTransaction`を処理する必要があります。シーケンサーは、レプリカノードとピアリングして新しい`unsafe`ブロックをネットワークの残りの部分に伝播させることができます。

<Image src="/img/builders/chain-operators/sequencer-node.png" alt="シーケンサーノードの図" width={400} height={400} />

### レプリカノード

レプリカノードはネットワーク上の追加ノードです。これらはシーケンサー（インターネットに接続されていない可能性がある）および他のレプリカとピアリングできます。追加のレプリカは、RPCリクエストの水平スケーリングを支援します。

<Image src="/img/builders/chain-operators/replica-node.png" alt="レプリカノードの図" width={200} height={200} />

## 次のステップ

*   チェーン上で[snap sync](/builders/chain-operators/management/snap-sync)をサポートする方法を見つけましょう。
*   トランザクション手数料コストを削減するために[blob space](/builders/chain-operators/management/blobs)を利用する方法を見つけましょう。
